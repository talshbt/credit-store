/**
 * @fileoverview added by tsickle
 * Generated from: lib/code-input.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { __awaiter } from "tslib";
import { Component, EventEmitter, Inject, Input, Optional, Output, QueryList, ViewChildren } from '@angular/core';
import { CodeInputComponentConfigToken, defaultComponentConfig } from './code-input.component.config';
/** @enum {number} */
const InputState = {
    ready: 0,
    reset: 1,
};
InputState[InputState.ready] = 'ready';
InputState[InputState.reset] = 'reset';
export class CodeInputComponent {
    /**
     * @param {?=} config
     */
    constructor(config) {
        /**
         * @deprecated Use isCharsCode prop instead.
         */
        this.isNonDigitsCode = false;
        this.codeChanged = new EventEmitter();
        this.codeCompleted = new EventEmitter();
        this.inputs = [];
        this.inputsStates = [];
        this.state = {
            isFocusingAfterAppearingCompleted: false,
            isInitialFocusFieldEnabled: false
        };
        Object.assign(this, defaultComponentConfig);
        if (!config) {
            return;
        }
        // filtering for only valid config props
        for (const prop in config) {
            if (!config.hasOwnProperty(prop)) {
                continue;
            }
            if (!defaultComponentConfig.hasOwnProperty(prop)) {
                continue;
            }
            // @ts-ignore
            this[prop] = config[prop];
        }
    }
    /**
     * Life cycle
     * @return {?}
     */
    ngOnInit() {
        // defining internal code length prop for skipping external prop updates
        this._codeLength = this.codeLength;
        this.placeholders = Array(this._codeLength).fill(1);
        this.state.isInitialFocusFieldEnabled = !this.isEmpty(this.initialFocusField);
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        this.inputsList.forEach((/**
         * @param {?} item
         * @return {?}
         */
        (item) => {
            this.inputs.push(item.nativeElement);
            this.inputsStates.push(InputState.ready);
        }));
        // the @Input code might have value. Checking
        this.onInputCodeChanges();
    }
    /**
     * @return {?}
     */
    ngAfterViewChecked() {
        this.focusOnInputAfterAppearing();
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (changes.code) {
            this.onInputCodeChanges();
        }
    }
    /**
     * Methods
     * @param {?=} isChangesEmitting
     * @return {?}
     */
    reset(isChangesEmitting = false) {
        // resetting the code to its initial value or to an empty value
        this.onInputCodeChanges();
        if (this.state.isInitialFocusFieldEnabled) {
            // tslint:disable-next-line:no-non-null-assertion
            this.focusOnField((/** @type {?} */ (this.initialFocusField)));
        }
        if (isChangesEmitting) {
            this.emitChanges();
        }
    }
    /**
     * @param {?} index
     * @return {?}
     */
    focusOnField(index) {
        if (index >= this._codeLength) {
            throw new Error('The index of the focusing input box should be less than the codeLength.');
        }
        this.inputs[index].focus();
    }
    /**
     * @param {?} e
     * @return {?}
     */
    onClick(e) {
        // handle click events only if the the prop is enabled
        if (!this.isFocusingOnLastByClickIfFilled) {
            return;
        }
        /** @type {?} */
        const target = e.target;
        /** @type {?} */
        const last = this.inputs[this._codeLength - 1];
        // already focused
        if (target === last) {
            return;
        }
        // check filling
        /** @type {?} */
        const isFilled = this.getCurrentFilledCode().length >= this._codeLength;
        if (!isFilled) {
            return;
        }
        // focusing on the last input if is filled
        setTimeout((/**
         * @return {?}
         */
        () => last.focus()));
    }
    /**
     * @param {?} e
     * @param {?} i
     * @return {?}
     */
    onInput(e, i) {
        /** @type {?} */
        const target = e.target;
        /** @type {?} */
        const value = e.data || target.value;
        if (this.isEmpty(value)) {
            return;
        }
        // only digits are allowed if isCharsCode flag is absent/false
        if (!this.canInputValue(value)) {
            e.preventDefault();
            e.stopPropagation();
            this.setInputValue(target, null);
            this.setStateForInput(target, InputState.reset);
            return;
        }
        /** @type {?} */
        const values = value.toString().trim().split('');
        for (let j = 0; j < values.length; j++) {
            /** @type {?} */
            const index = j + i;
            if (index > this._codeLength - 1) {
                break;
            }
            this.setInputValue(this.inputs[index], values[j]);
        }
        this.emitChanges();
        /** @type {?} */
        const next = i + values.length;
        if (next > this._codeLength - 1) {
            target.blur();
            return;
        }
        this.inputs[next].focus();
    }
    /**
     * @param {?} e
     * @param {?} i
     * @return {?}
     */
    onPaste(e, i) {
        e.preventDefault();
        e.stopPropagation();
        /** @type {?} */
        const data = e.clipboardData ? e.clipboardData.getData('text').trim() : undefined;
        if (this.isEmpty(data)) {
            return;
        }
        // Convert paste text into iterable
        // tslint:disable-next-line:no-non-null-assertion
        /** @type {?} */
        const values = (/** @type {?} */ (data)).split('');
        /** @type {?} */
        let valIndex = 0;
        for (let j = i; j < this.inputs.length; j++) {
            // The values end is reached. Loop exit
            if (valIndex === values.length) {
                break;
            }
            /** @type {?} */
            const input = this.inputs[j];
            /** @type {?} */
            const val = values[valIndex];
            // Cancel the loop when a value cannot be used
            if (!this.canInputValue(val)) {
                this.setInputValue(input, null);
                this.setStateForInput(input, InputState.reset);
                return;
            }
            this.setInputValue(input, val.toString());
            valIndex++;
        }
        this.inputs[i].blur();
        this.emitChanges();
    }
    /**
     * @param {?} e
     * @param {?} i
     * @return {?}
     */
    onKeydown(e, i) {
        return __awaiter(this, void 0, void 0, function* () {
            /** @type {?} */
            const target = e.target;
            /** @type {?} */
            const isTargetEmpty = this.isEmpty(target.value);
            /** @type {?} */
            const prev = i - 1;
            // processing only backspace events
            /** @type {?} */
            const isBackspaceKey = yield this.isBackspaceKey(e);
            if (!isBackspaceKey) {
                return;
            }
            e.preventDefault();
            this.setInputValue(target, null);
            if (!isTargetEmpty) {
                this.emitChanges();
            }
            if (prev < 0) {
                return;
            }
            if (isTargetEmpty || this.isPrevFocusableAfterClearing) {
                this.inputs[prev].focus();
            }
        });
    }
    /**
     * @private
     * @return {?}
     */
    onInputCodeChanges() {
        if (!this.inputs.length) {
            return;
        }
        if (this.isEmpty(this.code)) {
            this.inputs.forEach((/**
             * @param {?} input
             * @return {?}
             */
            (input) => {
                this.setInputValue(input, null);
            }));
            return;
        }
        // tslint:disable-next-line:no-non-null-assertion
        /** @type {?} */
        const chars = (/** @type {?} */ (this.code)).toString().trim().split('');
        // checking if all the values are correct
        /** @type {?} */
        let isAllCharsAreAllowed = true;
        for (const char of chars) {
            if (!this.canInputValue(char)) {
                isAllCharsAreAllowed = false;
                break;
            }
        }
        this.inputs.forEach((/**
         * @param {?} input
         * @param {?} index
         * @return {?}
         */
        (input, index) => {
            /** @type {?} */
            const value = isAllCharsAreAllowed ? chars[index] : null;
            this.setInputValue(input, value);
        }));
    }
    /**
     * @private
     * @return {?}
     */
    focusOnInputAfterAppearing() {
        if (!this.state.isInitialFocusFieldEnabled) {
            return;
        }
        if (this.state.isFocusingAfterAppearingCompleted) {
            return;
        }
        // tslint:disable-next-line:no-non-null-assertion
        this.focusOnField((/** @type {?} */ (this.initialFocusField)));
        // tslint:disable-next-line:no-non-null-assertion
        this.state.isFocusingAfterAppearingCompleted = document.activeElement === this.inputs[(/** @type {?} */ (this.initialFocusField))];
    }
    /**
     * @private
     * @return {?}
     */
    emitChanges() {
        setTimeout((/**
         * @return {?}
         */
        () => this.emitCode()), 50);
    }
    /**
     * @private
     * @return {?}
     */
    emitCode() {
        /** @type {?} */
        const code = this.getCurrentFilledCode();
        this.codeChanged.emit(code);
        if (code.length >= this._codeLength) {
            this.codeCompleted.emit(code);
        }
    }
    /**
     * @private
     * @return {?}
     */
    getCurrentFilledCode() {
        /** @type {?} */
        let code = '';
        for (const input of this.inputs) {
            if (!this.isEmpty(input.value)) {
                code += input.value;
            }
        }
        return code;
    }
    /**
     * @private
     * @param {?} e
     * @return {?}
     */
    isBackspaceKey(e) {
        /** @type {?} */
        const isBackspace = (e.key && e.key.toLowerCase() === 'backspace') || (e.keyCode && e.keyCode === 8);
        if (isBackspace) {
            return Promise.resolve(true);
        }
        // process only key with placeholder keycode on android devices
        if (!e.keyCode || e.keyCode !== 229) {
            return Promise.resolve(false);
        }
        return new Promise((/**
         * @param {?} resolve
         * @return {?}
         */
        (resolve) => {
            setTimeout((/**
             * @return {?}
             */
            () => {
                /** @type {?} */
                const input = e.target;
                /** @type {?} */
                const isReset = this.getStateForInput(input) === InputState.reset;
                if (isReset) {
                    this.setStateForInput(input, InputState.ready);
                }
                // if backspace key pressed the caret will have position 0 (for single value field)
                resolve(input.selectionStart === 0 && !isReset);
            }));
        }));
    }
    /**
     * @private
     * @param {?} input
     * @param {?} value
     * @return {?}
     */
    setInputValue(input, value) {
        /** @type {?} */
        const isEmpty = this.isEmpty(value);
        /** @type {?} */
        const valueClassCSS = 'has-value';
        /** @type {?} */
        const emptyClassCSS = 'empty';
        if (isEmpty) {
            input.value = '';
            input.classList.remove(valueClassCSS);
            // tslint:disable-next-line:no-non-null-assertion
            (/** @type {?} */ (input.parentElement)).classList.add(emptyClassCSS);
        }
        else {
            input.value = value;
            input.classList.add(valueClassCSS);
            // tslint:disable-next-line:no-non-null-assertion
            (/** @type {?} */ (input.parentElement)).classList.remove(emptyClassCSS);
        }
    }
    /**
     * @private
     * @param {?} value
     * @return {?}
     */
    canInputValue(value) {
        if (this.isEmpty(value)) {
            return false;
        }
        /** @type {?} */
        const isDigitsValue = /^[0-9]+$/.test(value.toString());
        return isDigitsValue || (this.isCharsCode || this.isNonDigitsCode);
    }
    /**
     * @private
     * @param {?} input
     * @param {?} state
     * @return {?}
     */
    setStateForInput(input, state) {
        /** @type {?} */
        const index = this.inputs.indexOf(input);
        if (index < 0) {
            return;
        }
        this.inputsStates[index] = state;
    }
    /**
     * @private
     * @param {?} input
     * @return {?}
     */
    getStateForInput(input) {
        /** @type {?} */
        const index = this.inputs.indexOf(input);
        return this.inputsStates[index];
    }
    /**
     * @private
     * @param {?} value
     * @return {?}
     */
    isEmpty(value) {
        return value === null || value === undefined || !value.toString().length;
    }
}
CodeInputComponent.decorators = [
    { type: Component, args: [{
                // tslint:disable-next-line:component-selector
                selector: 'code-input',
                template: "<span *ngFor=\"let holder of placeholders; index as i\"\n      [class.code-hidden]=\"isCodeHidden\">\n  <input #input\n         (click)=\"onClick($event)\"\n         (paste)=\"onPaste($event, i)\"\n         (input)=\"onInput($event, i)\"\n         (keydown)=\"onKeydown($event, i)\"\n         [type]=\"inputType\"/>\n</span>\n",
                styles: [":host{--color:#171516;--item-background:transparent;--item-border:1px solid #ddd;--item-border-bottom:1px solid #ddd;--item-border-bottom-focused:1px solid #ddd;--item-border-bottom-has-value:1px solid #ddd;--item-border-focused:1px solid #ddd;--item-border-has-value:1px solid #ddd;--item-border-radius:5px;--item-height:4.375em;--item-shadow-focused:0px 1px 5px #ddd;--item-spacing:4px;--text-security-type:disc;color:var(--color);display:flex;font-size:inherit;transform:translateZ(0)}:host span{display:block;flex:1;padding-right:var(--item-spacing)}:host span:first-child{padding-left:var(--item-spacing)}:host span.code-hidden input{-moz-text-security:var(--text-security-type);-webkit-text-security:var(--text-security-type);text-security:var(--text-security-type)}:host input{-webkit-appearance:none;-webkit-transform:translateZ(0);background:var(--item-background);border:var(--item-border);border-bottom:var(--item-border-bottom);border-radius:var(--item-border-radius);color:inherit;font-size:inherit;height:var(--item-height);outline:none;text-align:center;transform:translateZ(0);width:100%}:host input.has-value{border:var(--item-border-has-value);border-bottom:var(--item-border-bottom-has-value)}:host input:focus{border:var(--item-border-focused);border-bottom:var(--item-border-bottom-focused);box-shadow:var(--item-shadow-focused)}"]
            }] }
];
/** @nocollapse */
CodeInputComponent.ctorParameters = () => [
    { type: undefined, decorators: [{ type: Optional }, { type: Inject, args: [CodeInputComponentConfigToken,] }] }
];
CodeInputComponent.propDecorators = {
    inputsList: [{ type: ViewChildren, args: ['input',] }],
    codeLength: [{ type: Input }],
    inputType: [{ type: Input }],
    initialFocusField: [{ type: Input }],
    isNonDigitsCode: [{ type: Input }],
    isCharsCode: [{ type: Input }],
    isCodeHidden: [{ type: Input }],
    isPrevFocusableAfterClearing: [{ type: Input }],
    isFocusingOnLastByClickIfFilled: [{ type: Input }],
    code: [{ type: Input }],
    codeChanged: [{ type: Output }],
    codeCompleted: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    CodeInputComponent.prototype.inputsList;
    /** @type {?} */
    CodeInputComponent.prototype.codeLength;
    /** @type {?} */
    CodeInputComponent.prototype.inputType;
    /** @type {?} */
    CodeInputComponent.prototype.initialFocusField;
    /**
     * @deprecated Use isCharsCode prop instead.
     * @type {?}
     */
    CodeInputComponent.prototype.isNonDigitsCode;
    /** @type {?} */
    CodeInputComponent.prototype.isCharsCode;
    /** @type {?} */
    CodeInputComponent.prototype.isCodeHidden;
    /** @type {?} */
    CodeInputComponent.prototype.isPrevFocusableAfterClearing;
    /** @type {?} */
    CodeInputComponent.prototype.isFocusingOnLastByClickIfFilled;
    /** @type {?} */
    CodeInputComponent.prototype.code;
    /** @type {?} */
    CodeInputComponent.prototype.codeChanged;
    /** @type {?} */
    CodeInputComponent.prototype.codeCompleted;
    /** @type {?} */
    CodeInputComponent.prototype.placeholders;
    /**
     * @type {?}
     * @private
     */
    CodeInputComponent.prototype.inputs;
    /**
     * @type {?}
     * @private
     */
    CodeInputComponent.prototype.inputsStates;
    /**
     * @type {?}
     * @private
     */
    CodeInputComponent.prototype._codeLength;
    /**
     * @type {?}
     * @private
     */
    CodeInputComponent.prototype.state;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29kZS1pbnB1dC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9hbmd1bGFyLWNvZGUtaW5wdXQvc3JjL2xpYi9jb2RlLWlucHV0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxPQUFPLEVBR0wsU0FBUyxFQUVULFlBQVksRUFDWixNQUFNLEVBQ04sS0FBSyxFQUdMLFFBQVEsRUFDUixNQUFNLEVBQ04sU0FBUyxFQUVULFlBQVksRUFDYixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBRUwsNkJBQTZCLEVBQzdCLHNCQUFzQixFQUN2QixNQUFNLCtCQUErQixDQUFDOztBQUV2QyxNQUFLLFVBQVU7SUFDYixLQUFLLEdBQUk7SUFDVCxLQUFLLEdBQUk7RUFDVjs7O0FBUUQsTUFBTSxPQUFPLGtCQUFrQjs7OztJQThCN0IsWUFBK0QsTUFBaUM7Ozs7UUF0QnZGLG9CQUFlLEdBQUcsS0FBSyxDQUFDO1FBT2QsZ0JBQVcsR0FBRyxJQUFJLFlBQVksRUFBVSxDQUFDO1FBQ3pDLGtCQUFhLEdBQUcsSUFBSSxZQUFZLEVBQVUsQ0FBQztRQUl0RCxXQUFNLEdBQXVCLEVBQUUsQ0FBQztRQUNoQyxpQkFBWSxHQUFpQixFQUFFLENBQUM7UUFJaEMsVUFBSyxHQUFHO1lBQ2QsaUNBQWlDLEVBQUUsS0FBSztZQUN4QywwQkFBMEIsRUFBRSxLQUFLO1NBQ2xDLENBQUM7UUFHQSxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxzQkFBc0IsQ0FBQyxDQUFDO1FBRTVDLElBQUksQ0FBQyxNQUFNLEVBQUU7WUFDWCxPQUFPO1NBQ1I7UUFFRCx3Q0FBd0M7UUFDeEMsS0FBSyxNQUFNLElBQUksSUFBSSxNQUFNLEVBQUU7WUFDekIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLEVBQUU7Z0JBQ2hDLFNBQVM7YUFDVjtZQUVELElBQUksQ0FBQyxzQkFBc0IsQ0FB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QU87eUJBRXBCLEtBQUs7d0JBQ0wsS0FBSztnQ0FDTCxLQUFLOzhCQUVMLEtBQUs7MEJBQ0wsS0FBSzsyQkFDTCxLQUFLOzJDQUNMLEtBQUs7OENBQ0wsS0FBSzttQkFDTCxLQUFLOzBCQUVMLE1BQU07NEJBQ04sTUFBTTs7OztJQWRQLHdDQUEyRDs7SUFFM0Qsd0NBQThCOztJQUM5Qix1Q0FBNkI7O0lBQzdCLCtDQUFvQzs7Ozs7SUFFcEMsNkNBQWlDOztJQUNqQyx5Q0FBZ0M7O0lBQ2hDLDBDQUFpQzs7SUFDakMsMERBQWlEOztJQUNqRCw2REFBb0Q7O0lBQ3BELGtDQUFpQzs7SUFFakMseUNBQTREOztJQUM1RCwyQ0FBOEQ7O0lBRTlELDBDQUFnQzs7Ozs7SUFFaEMsb0NBQXdDOzs7OztJQUN4QywwQ0FBd0M7Ozs7O0lBR3hDLHlDQUE4Qjs7Ozs7SUFDOUIsbUNBR0UiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBBZnRlclZpZXdDaGVja2VkLFxuICBBZnRlclZpZXdJbml0LFxuICBDb21wb25lbnQsXG4gIEVsZW1lbnRSZWYsXG4gIEV2ZW50RW1pdHRlcixcbiAgSW5qZWN0LFxuICBJbnB1dCxcbiAgT25DaGFuZ2VzLFxuICBPbkluaXQsXG4gIE9wdGlvbmFsLFxuICBPdXRwdXQsXG4gIFF1ZXJ5TGlzdCxcbiAgU2ltcGxlQ2hhbmdlcyxcbiAgVmlld0NoaWxkcmVuXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtcbiAgQ29kZUlucHV0Q29tcG9uZW50Q29uZmlnLFxuICBDb2RlSW5wdXRDb21wb25lbnRDb25maWdUb2tlbixcbiAgZGVmYXVsdENvbXBvbmVudENvbmZpZ1xufSBmcm9tICcuL2NvZGUtaW5wdXQuY29tcG9uZW50LmNvbmZpZyc7XG5cbmVudW0gSW5wdXRTdGF0ZSB7XG4gIHJlYWR5ID0gMCxcbiAgcmVzZXQgPSAxXG59XG5cbkBDb21wb25lbnQoe1xuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6Y29tcG9uZW50LXNlbGVjdG9yXG4gIHNlbGVjdG9yOiAnY29kZS1pbnB1dCcsXG4gIHRlbXBsYXRlVXJsOiAnY29kZS1pbnB1dC5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL2NvZGUtaW5wdXQuY29tcG9uZW50LnNjc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBDb2RlSW5wdXRDb21wb25lbnQgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0LCBPbkluaXQsIE9uQ2hhbmdlcywgQWZ0ZXJWaWV3Q2hlY2tlZCwgQ29kZUlucHV0Q29tcG9uZW50Q29uZmlnIHtcblxuICBAVmlld0NoaWxkcmVuKCdpbnB1dCcpIGlucHV0c0xpc3QgITogUXVlcnlMaXN0PEVsZW1lbnRSZWY+O1xuXG4gIEBJbnB1dCgpIGNvZGVMZW5ndGggITogbnVtYmVyO1xuICBASW5wdXQoKSBpbnB1dFR5cGUgITogc3RyaW5nO1xuICBASW5wdXQoKSBpbml0aWFsRm9jdXNGaWVsZD86IG51bWJlcjtcbiAgLyoqIEBkZXByZWNhdGVkIFVzZSBpc0NoYXJzQ29kZSBwcm9wIGluc3RlYWQuICovXG4gIEBJbnB1dCgpIGlzTm9uRGlnaXRzQ29kZSA9IGZhbHNlO1xuICBASW5wdXQoKSBpc0NoYXJzQ29kZSAhOiBib29sZWFuO1xuICBASW5wdXQoKSBpc0NvZGVIaWRkZW4gITogYm9vbGVhbjtcbiAgQElucHV0KCkgaXNQcmV2Rm9jdXNhYmxlQWZ0ZXJDbGVhcmluZyAhOiBib29sZWFuO1xuICBASW5wdXQoKSBpc0ZvY3VzaW5nT25MYXN0QnlDbGlja0lmRmlsbGVkICE6IGJvb2xlYW47XG4gIEBJbnB1dCgpIGNvZGUgPzogc3RyaW5nIHwgbnVtYmVyO1xuXG4gIEBPdXRwdXQoKSByZWFkb25seSBjb2RlQ2hhbmdlZCA9IG5ldyBFdmVudEVtaXR0ZXI8c3RyaW5nPigpO1xuICBAT3V0cHV0KCkgcmVhZG9ubHkgY29kZUNvbXBsZXRlZCA9IG5ldyBFdmVudEVtaXR0ZXI8c3RyaW5nPigpO1xuXG4gIHB1YmxpYyBwbGFjZWhvbGRlcnMgITogbnVtYmVyW107XG5cbiAgcHJpdmF0ZSBpbnB1dHM6IEhUTUxJbnB1dEVsZW1lbnRbXSA9IFtdO1xuICBwcml2YXRlIGlucHV0c1N0YXRlczogSW5wdXRTdGF0ZVtdID0gW107XG5cbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOnZhcmlhYmxlLW5hbWVcbiAgcHJpdmF0ZSBfY29kZUxlbmd0aCAhOiBudW1iZXI7XG4gIHByaXZhdGUgc3RhdGUgPSB7XG4gICAgaXNGb2N1c2luZ0FmdGVyQXBwZWFyaW5nQ29tcGxldGVkOiBmYWxzZSxcbiAgICBpc0luaXRpYWxGb2N1c0ZpZWxkRW5hYmxlZDogZmFsc2VcbiAgfTtcblxuICBjb25zdHJ1Y3RvcihAT3B0aW9uYWwoKSBASW5qZWN0KENvZGVJbnB1dENvbXBvbmVudENvbmZpZ1Rva2VuKSBjb25maWc/OiBDb2RlSW5wdXRDb21wb25lbnRDb25maWcpIHtcbiAgICBPYmplY3QuYXNzaWduKHRoaXMsIGRlZmF1bHRDb21wb25lbnRDb25maWcpO1xuXG4gICAgaWYgKCFjb25maWcpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBmaWx0ZXJpbmcgZm9yIG9ubHkgdmFsaWQgY29uZmlnIHByb3BzXG4gICAgZm9yIChjb25zdCBwcm9wIGluIGNvbmZpZykge1xuICAgICAgaWYgKCFjb25maWcuaGFzT3duUHJvcGVydHkocHJvcCkpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIGlmICghZGVmYXVsdENvbXBvbmVudENvbmZpZy5oYXNPd25Qcm9wZXJ0eShwcm9wKSkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgdGhpc1twcm9wXSA9IGNvbmZpZ1twcm9wXTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTGlmZSBjeWNsZVxuICAgKi9cblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICAvLyBkZWZpbmluZyBpbnRlcm5hbCBjb2RlIGxlbmd0aCBwcm9wIGZvciBza2lwcGluZyBleHRlcm5hbCBwcm9wIHVwZGF0ZXNcbiAgICB0aGlzLl9jb2RlTGVuZ3RoID0gdGhpcy5jb2RlTGVuZ3RoO1xuICAgIHRoaXMucGxhY2Vob2xkZXJzID0gQXJyYXkodGhpcy5fY29kZUxlbmd0aCkuZmlsbCgxKTtcbiAgICB0aGlzLnN0YXRlLmlzSW5pdGlhbEZvY3VzRmllbGRFbmFibGVkID0gIXRoaXMuaXNFbXB0eSh0aGlzLmluaXRpYWxGb2N1c0ZpZWxkKTtcbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLmlucHV0c0xpc3QuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgdGhpcy5pbnB1dHMucHVzaChpdGVtLm5hdGl2ZUVsZW1lbnQpO1xuICAgICAgdGhpcy5pbnB1dHNTdGF0ZXMucHVzaChJbnB1dFN0YXRlLnJlYWR5KTtcbiAgICB9KTtcblxuICAgIC8vIHRoZSBASW5wdXQgY29kZSBtaWdodCBoYXZlIHZhbHVlLiBDaGVja2luZ1xuICAgIHRoaXMub25JbnB1dENvZGVDaGFuZ2VzKCk7XG4gIH1cblxuICBuZ0FmdGVyVmlld0NoZWNrZWQoKTogdm9pZCB7XG4gICAgdGhpcy5mb2N1c09uSW5wdXRBZnRlckFwcGVhcmluZygpO1xuICB9XG5cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xuICAgIGlmIChjaGFuZ2VzLmNvZGUpIHtcbiAgICAgIHRoaXMub25JbnB1dENvZGVDaGFuZ2VzKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIE1ldGhvZHNcbiAgICovXG5cbiAgcmVzZXQoaXNDaGFuZ2VzRW1pdHRpbmcgPSBmYWxzZSk6IHZvaWQge1xuICAgIC8vIHJlc2V0dGluZyB0aGUgY29kZSB0byBpdHMgaW5pdGlhbCB2YWx1ZSBvciB0byBhbiBlbXB0eSB2YWx1ZVxuICAgIHRoaXMub25JbnB1dENvZGVDaGFuZ2VzKCk7XG5cbiAgICBpZiAodGhpcy5zdGF0ZS5pc0luaXRpYWxGb2N1c0ZpZWxkRW5hYmxlZCkge1xuICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLW5vbi1udWxsLWFzc2VydGlvblxuICAgICAgdGhpcy5mb2N1c09uRmllbGQodGhpcy5pbml0aWFsRm9jdXNGaWVsZCEpO1xuICAgIH1cblxuICAgIGlmIChpc0NoYW5nZXNFbWl0dGluZykge1xuICAgICAgdGhpcy5lbWl0Q2hhbmdlcygpO1xuICAgIH1cbiAgfVxuXG4gIGZvY3VzT25GaWVsZChpbmRleDogbnVtYmVyKTogdm9pZCB7XG4gICAgaWYgKGluZGV4ID49IHRoaXMuX2NvZGVMZW5ndGgpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIGluZGV4IG9mIHRoZSBmb2N1c2luZyBpbnB1dCBib3ggc2hvdWxkIGJlIGxlc3MgdGhhbiB0aGUgY29kZUxlbmd0aC4nKTtcbiAgICB9XG5cbiAgICB0aGlzLmlucHV0c1tpbmRleF0uZm9jdXMoKTtcbiAgfVxuXG4gIG9uQ2xpY2soZTogYW55KTogdm9pZCB7XG4gICAgLy8gaGFuZGxlIGNsaWNrIGV2ZW50cyBvbmx5IGlmIHRoZSB0aGUgcHJvcCBpcyBlbmFibGVkXG4gICAgaWYgKCF0aGlzLmlzRm9jdXNpbmdPbkxhc3RCeUNsaWNrSWZGaWxsZWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCB0YXJnZXQgPSBlLnRhcmdldDtcbiAgICBjb25zdCBsYXN0ID0gdGhpcy5pbnB1dHNbdGhpcy5fY29kZUxlbmd0aCAtIDFdO1xuICAgIC8vIGFscmVhZHkgZm9jdXNlZFxuICAgIGlmICh0YXJnZXQgPT09IGxhc3QpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBjaGVjayBmaWxsaW5nXG4gICAgY29uc3QgaXNGaWxsZWQgPSB0aGlzLmdldEN1cnJlbnRGaWxsZWRDb2RlKCkubGVuZ3RoID49IHRoaXMuX2NvZGVMZW5ndGg7XG4gICAgaWYgKCFpc0ZpbGxlZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIGZvY3VzaW5nIG9uIHRoZSBsYXN0IGlucHV0IGlmIGlzIGZpbGxlZFxuICAgIHNldFRpbWVvdXQoKCkgPT4gbGFzdC5mb2N1cygpKTtcbiAgfVxuXG4gIG9uSW5wdXQoZTogYW55LCBpOiBudW1iZXIpOiB2b2lkIHtcbiAgICBjb25zdCB0YXJnZXQgPSBlLnRhcmdldDtcbiAgICBjb25zdCB2YWx1ZSA9IGUuZGF0YSB8fCB0YXJnZXQudmFsdWU7XG5cbiAgICBpZiAodGhpcy5pc0VtcHR5KHZhbHVlKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIG9ubHkgZGlnaXRzIGFyZSBhbGxvd2VkIGlmIGlzQ2hhcnNDb2RlIGZsYWcgaXMgYWJzZW50L2ZhbHNlXG4gICAgaWYgKCF0aGlzLmNhbklucHV0VmFsdWUodmFsdWUpKSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgdGhpcy5zZXRJbnB1dFZhbHVlKHRhcmdldCwgbnVsbCk7XG4gICAgICB0aGlzLnNldFN0YXRlRm9ySW5wdXQodGFyZ2V0LCBJbnB1dFN0YXRlLnJlc2V0KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCB2YWx1ZXMgPSB2YWx1ZS50b1N0cmluZygpLnRyaW0oKS5zcGxpdCgnJyk7XG4gICAgZm9yIChsZXQgaiA9IDA7IGogPCB2YWx1ZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgIGNvbnN0IGluZGV4ID0gaiArIGk7XG4gICAgICBpZiAoaW5kZXggPiB0aGlzLl9jb2RlTGVuZ3RoIC0gMSkge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cblxuICAgICAgdGhpcy5zZXRJbnB1dFZhbHVlKHRoaXMuaW5wdXRzW2luZGV4XSwgdmFsdWVzW2pdKTtcbiAgICB9XG4gICAgdGhpcy5lbWl0Q2hhbmdlcygpO1xuXG4gICAgY29uc3QgbmV4dCA9IGkgKyB2YWx1ZXMubGVuZ3RoO1xuICAgIGlmIChuZXh0ID4gdGhpcy5fY29kZUxlbmd0aCAtIDEpIHtcbiAgICAgIHRhcmdldC5ibHVyKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5pbnB1dHNbbmV4dF0uZm9jdXMoKTtcbiAgfVxuXG4gIG9uUGFzdGUoZTogQ2xpcGJvYXJkRXZlbnQsIGk6IG51bWJlcik6IHZvaWQge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuXG4gICAgY29uc3QgZGF0YSA9IGUuY2xpcGJvYXJkRGF0YSA/IGUuY2xpcGJvYXJkRGF0YS5nZXREYXRhKCd0ZXh0JykudHJpbSgpIDogdW5kZWZpbmVkO1xuXG4gICAgaWYgKHRoaXMuaXNFbXB0eShkYXRhKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIENvbnZlcnQgcGFzdGUgdGV4dCBpbnRvIGl0ZXJhYmxlXG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLW5vbi1udWxsLWFzc2VydGlvblxuICAgIGNvbnN0IHZhbHVlcyA9IGRhdGEhLnNwbGl0KCcnKTtcbiAgICBsZXQgdmFsSW5kZXggPSAwO1xuXG4gICAgZm9yIChsZXQgaiA9IGk7IGogPCB0aGlzLmlucHV0cy5sZW5ndGg7IGorKykge1xuICAgICAgLy8gVGhlIHZhbHVlcyBlbmQgaXMgcmVhY2hlZC4gTG9vcCBleGl0XG4gICAgICBpZiAodmFsSW5kZXggPT09IHZhbHVlcy5sZW5ndGgpIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGlucHV0ID0gdGhpcy5pbnB1dHNbal07XG4gICAgICBjb25zdCB2YWwgPSB2YWx1ZXNbdmFsSW5kZXhdO1xuXG4gICAgICAvLyBDYW5jZWwgdGhlIGxvb3Agd2hlbiBhIHZhbHVlIGNhbm5vdCBiZSB1c2VkXG4gICAgICBpZiAoIXRoaXMuY2FuSW5wdXRWYWx1ZSh2YWwpKSB7XG4gICAgICAgIHRoaXMuc2V0SW5wdXRWYWx1ZShpbnB1dCwgbnVsbCk7XG4gICAgICAgIHRoaXMuc2V0U3RhdGVGb3JJbnB1dChpbnB1dCwgSW5wdXRTdGF0ZS5yZXNldCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdGhpcy5zZXRJbnB1dFZhbHVlKGlucHV0LCB2YWwudG9TdHJpbmcoKSk7XG4gICAgICB2YWxJbmRleCsrO1xuICAgIH1cblxuICAgIHRoaXMuaW5wdXRzW2ldLmJsdXIoKTtcbiAgICB0aGlzLmVtaXRDaGFuZ2VzKCk7XG4gIH1cblxuICBhc3luYyBvbktleWRvd24oZTogYW55LCBpOiBudW1iZXIpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCB0YXJnZXQgPSBlLnRhcmdldDtcbiAgICBjb25zdCBpc1RhcmdldEVtcHR5ID0gdGhpcy5pc0VtcHR5KHRhcmdldC52YWx1ZSk7XG4gICAgY29uc3QgcHJldiA9IGkgLSAxO1xuXG4gICAgLy8gcHJvY2Vzc2luZyBvbmx5IGJhY2tzcGFjZSBldmVudHNcbiAgICBjb25zdCBpc0JhY2tzcGFjZUtleSA9IGF3YWl0IHRoaXMuaXNCYWNrc3BhY2VLZXkoZSk7XG4gICAgaWYgKCFpc0JhY2tzcGFjZUtleSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgIHRoaXMuc2V0SW5wdXRWYWx1ZSh0YXJnZXQsIG51bGwpO1xuICAgIGlmICghaXNUYXJnZXRFbXB0eSkge1xuICAgICAgdGhpcy5lbWl0Q2hhbmdlcygpO1xuICAgIH1cblxuICAgIGlmIChwcmV2IDwgMCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChpc1RhcmdldEVtcHR5IHx8IHRoaXMuaXNQcmV2Rm9jdXNhYmxlQWZ0ZXJDbGVhcmluZykge1xuICAgICAgdGhpcy5pbnB1dHNbcHJldl0uZm9jdXMoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIG9uSW5wdXRDb2RlQ2hhbmdlcygpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMuaW5wdXRzLmxlbmd0aCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmlzRW1wdHkodGhpcy5jb2RlKSkge1xuICAgICAgdGhpcy5pbnB1dHMuZm9yRWFjaCgoaW5wdXQ6IEhUTUxJbnB1dEVsZW1lbnQpID0+IHtcbiAgICAgICAgdGhpcy5zZXRJbnB1dFZhbHVlKGlucHV0LCBudWxsKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1ub24tbnVsbC1hc3NlcnRpb25cbiAgICBjb25zdCBjaGFycyA9IHRoaXMuY29kZSEudG9TdHJpbmcoKS50cmltKCkuc3BsaXQoJycpO1xuICAgIC8vIGNoZWNraW5nIGlmIGFsbCB0aGUgdmFsdWVzIGFyZSBjb3JyZWN0XG4gICAgbGV0IGlzQWxsQ2hhcnNBcmVBbGxvd2VkID0gdHJ1ZTtcbiAgICBmb3IgKGNvbnN0IGNoYXIgb2YgY2hhcnMpIHtcbiAgICAgIGlmICghdGhpcy5jYW5JbnB1dFZhbHVlKGNoYXIpKSB7XG4gICAgICAgIGlzQWxsQ2hhcnNBcmVBbGxvd2VkID0gZmFsc2U7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuaW5wdXRzLmZvckVhY2goKGlucHV0OiBIVE1MSW5wdXRFbGVtZW50LCBpbmRleDogbnVtYmVyKSA9PiB7XG4gICAgICBjb25zdCB2YWx1ZSA9IGlzQWxsQ2hhcnNBcmVBbGxvd2VkID8gY2hhcnNbaW5kZXhdIDogbnVsbDtcbiAgICAgIHRoaXMuc2V0SW5wdXRWYWx1ZShpbnB1dCwgdmFsdWUpO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBmb2N1c09uSW5wdXRBZnRlckFwcGVhcmluZygpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMuc3RhdGUuaXNJbml0aWFsRm9jdXNGaWVsZEVuYWJsZWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5zdGF0ZS5pc0ZvY3VzaW5nQWZ0ZXJBcHBlYXJpbmdDb21wbGV0ZWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tbm9uLW51bGwtYXNzZXJ0aW9uXG4gICAgdGhpcy5mb2N1c09uRmllbGQodGhpcy5pbml0aWFsRm9jdXNGaWVsZCEpO1xuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1ub24tbnVsbC1hc3NlcnRpb25cbiAgICB0aGlzLnN0YXRlLmlzRm9jdXNpbmdBZnRlckFwcGVhcmluZ0NvbXBsZXRlZCA9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgPT09IHRoaXMuaW5wdXRzW3RoaXMuaW5pdGlhbEZvY3VzRmllbGQhXTtcbiAgfVxuXG4gIHByaXZhdGUgZW1pdENoYW5nZXMoKTogdm9pZCB7XG4gICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLmVtaXRDb2RlKCksIDUwKTtcbiAgfVxuXG4gIHByaXZhdGUgZW1pdENvZGUoKTogdm9pZCB7XG4gICAgY29uc3QgY29kZSA9IHRoaXMuZ2V0Q3VycmVudEZpbGxlZENvZGUoKTtcblxuICAgIHRoaXMuY29kZUNoYW5nZWQuZW1pdChjb2RlKTtcblxuICAgIGlmIChjb2RlLmxlbmd0aCA+PSB0aGlzLl9jb2RlTGVuZ3RoKSB7XG4gICAgICB0aGlzLmNvZGVDb21wbGV0ZWQuZW1pdChjb2RlKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdldEN1cnJlbnRGaWxsZWRDb2RlKCk6IHN0cmluZyB7XG4gICAgbGV0IGNvZGUgPSAnJztcblxuICAgIGZvciAoY29uc3QgaW5wdXQgb2YgdGhpcy5pbnB1dHMpIHtcbiAgICAgIGlmICghdGhpcy5pc0VtcHR5KGlucHV0LnZhbHVlKSkge1xuICAgICAgICBjb2RlICs9IGlucHV0LnZhbHVlO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBjb2RlO1xuICB9XG5cbiAgcHJpdmF0ZSBpc0JhY2tzcGFjZUtleShlOiBhbnkpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBjb25zdCBpc0JhY2tzcGFjZSA9IChlLmtleSAmJiBlLmtleS50b0xvd2VyQ2FzZSgpID09PSAnYmFja3NwYWNlJykgfHwgKGUua2V5Q29kZSAmJiBlLmtleUNvZGUgPT09IDgpO1xuICAgIGlmIChpc0JhY2tzcGFjZSkge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh0cnVlKTtcbiAgICB9XG5cbiAgICAvLyBwcm9jZXNzIG9ubHkga2V5IHdpdGggcGxhY2Vob2xkZXIga2V5Y29kZSBvbiBhbmRyb2lkIGRldmljZXNcbiAgICBpZiAoIWUua2V5Q29kZSB8fCBlLmtleUNvZGUgIT09IDIyOSkge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShmYWxzZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlPGJvb2xlYW4+KChyZXNvbHZlKSA9PiB7XG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgY29uc3QgaW5wdXQgPSBlLnRhcmdldDtcbiAgICAgICAgY29uc3QgaXNSZXNldCA9IHRoaXMuZ2V0U3RhdGVGb3JJbnB1dChpbnB1dCkgPT09IElucHV0U3RhdGUucmVzZXQ7XG4gICAgICAgIGlmIChpc1Jlc2V0KSB7XG4gICAgICAgICAgdGhpcy5zZXRTdGF0ZUZvcklucHV0KGlucHV0LCBJbnB1dFN0YXRlLnJlYWR5KTtcbiAgICAgICAgfVxuICAgICAgICAvLyBpZiBiYWNrc3BhY2Uga2V5IHByZXNzZWQgdGhlIGNhcmV0IHdpbGwgaGF2ZSBwb3NpdGlvbiAwIChmb3Igc2luZ2xlIHZhbHVlIGZpZWxkKVxuICAgICAgICByZXNvbHZlKGlucHV0LnNlbGVjdGlvblN0YXJ0ID09PSAwICYmICFpc1Jlc2V0KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRJbnB1dFZhbHVlKGlucHV0OiBIVE1MSW5wdXRFbGVtZW50LCB2YWx1ZTogYW55KTogdm9pZCB7XG4gICAgY29uc3QgaXNFbXB0eSA9IHRoaXMuaXNFbXB0eSh2YWx1ZSk7XG4gICAgY29uc3QgdmFsdWVDbGFzc0NTUyA9ICdoYXMtdmFsdWUnO1xuICAgIGNvbnN0IGVtcHR5Q2xhc3NDU1MgPSAnZW1wdHknO1xuICAgIGlmIChpc0VtcHR5KSB7XG4gICAgICBpbnB1dC52YWx1ZSA9ICcnO1xuICAgICAgaW5wdXQuY2xhc3NMaXN0LnJlbW92ZSh2YWx1ZUNsYXNzQ1NTKTtcbiAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1ub24tbnVsbC1hc3NlcnRpb25cbiAgICAgIGlucHV0LnBhcmVudEVsZW1lbnQhLmNsYXNzTGlzdC5hZGQoZW1wdHlDbGFzc0NTUyk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgaW5wdXQudmFsdWUgPSB2YWx1ZTtcbiAgICAgIGlucHV0LmNsYXNzTGlzdC5hZGQodmFsdWVDbGFzc0NTUyk7XG4gICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tbm9uLW51bGwtYXNzZXJ0aW9uXG4gICAgICBpbnB1dC5wYXJlbnRFbGVtZW50IS5jbGFzc0xpc3QucmVtb3ZlKGVtcHR5Q2xhc3NDU1MpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY2FuSW5wdXRWYWx1ZSh2YWx1ZTogYW55KTogYm9vbGVhbiB7XG4gICAgaWYgKHRoaXMuaXNFbXB0eSh2YWx1ZSkpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBjb25zdCBpc0RpZ2l0c1ZhbHVlID0gL15bMC05XSskLy50ZXN0KHZhbHVlLnRvU3RyaW5nKCkpO1xuICAgIHJldHVybiBpc0RpZ2l0c1ZhbHVlIHx8ICh0aGlzLmlzQ2hhcnNDb2RlIHx8IHRoaXMuaXNOb25EaWdpdHNDb2RlKTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0U3RhdGVGb3JJbnB1dChpbnB1dDogSFRNTElucHV0RWxlbWVudCwgc3RhdGU6IElucHV0U3RhdGUpOiB2b2lkIHtcbiAgICBjb25zdCBpbmRleCA9IHRoaXMuaW5wdXRzLmluZGV4T2YoaW5wdXQpO1xuICAgIGlmIChpbmRleCA8IDApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmlucHV0c1N0YXRlc1tpbmRleF0gPSBzdGF0ZTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0U3RhdGVGb3JJbnB1dChpbnB1dDogSFRNTElucHV0RWxlbWVudCk6IElucHV0U3RhdGUgfCB1bmRlZmluZWQge1xuICAgIGNvbnN0IGluZGV4ID0gdGhpcy5pbnB1dHMuaW5kZXhPZihpbnB1dCk7XG4gICAgcmV0dXJuIHRoaXMuaW5wdXRzU3RhdGVzW2luZGV4XTtcbiAgfVxuXG4gIHByaXZhdGUgaXNFbXB0eSh2YWx1ZTogYW55KTogYm9vbGVhbiB7XG4gICAgcmV0dXJuICB2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8ICF2YWx1ZS50b1N0cmluZygpLmxlbmd0aDtcbiAgfVxufVxuIl19